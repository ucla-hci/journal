<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Journey Alpha</title>
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-light-blue.css">
	<!-- jQuery -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="contextMenu/jquery.ui.position.min.js" type="text/javascript"></script>
	<!-- contextMenu -->
	<script src="contextMenu/jquery.contextMenu.js" type="text/javascript"></script>
	<link href="contextMenu/jquery.contextMenu.css" rel="stylesheet" type="text/css" />
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<!-- journal Core -->
	<script type="text/javascript" src="js/journal.js"></script>
	<!-- ot.js -->
	<script src="ot.js/text-operation.js"></script>
	<script src="ot.js/selection.js"></script>
	<script src="ot.js/wrapped-operation.js"></script>
	<script src="ot.js/undo-manager.js"></script>
	<script src="ot.js/client.js"></script>
	<script src="ot.js/codemirror-adapter.js"></script>
	<script src="ot.js/socketio-adapter.js"></script>
	<script src="ot.js/editor-client.js"></script>
	<!-- CodeMirror -->
	<link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css">
	<script src="node_modules/codemirror/lib/codemirror.js"></script>
	<script src="node_modules/codemirror/addon/search/searchcursor.js"></script>
	<script src="node_modules/codemirror/addon/selection/mark-selection.js"></script>
	<style>
		.CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}
		.CodeMirror-selectedtext { color: white; }
		.styled-background { background-color: #ff7; }
	</style>
	<!-- socket.io -->
	<script src="node_modules/socket.io-client/dist/socket.io.js"></script>

</head>
<body>
	<header>
		<div id="buttons">
			<button type="button" onclick="control(1)">Func1</button>
			<button type="button" onclick="control(2)">Func2</button>
			<button type="button" onclick="control(3)">Func3</button>
			<button type="button" onclick="Test()">Test</button>
		</div>
		<div id="tags">
			<footer id="clear_footer"></footer>
		</div>
	</header>

	<aside class="box" id="test">
        <ul>
            <li>
                <h3>Archive</h3>
            </li>
            <li><a id = "m1" href="#" onclick="swich(1)">Jounal 1</a></li>
            <li><a id = "m2" href="#" onclick="swich(2)">Jounal 2</a></li>
            <li><a id = "m3" href="#" onclick="swich(3)">Jounal 3</a></li>
            <li><a id = "m4" href="#" onclick="swich(4)">Jounal 4</a></li>
            <li><a id = "m5" href="#" onclick="swich(5)">Jounal 5</a></li>
            <li><a id = "m6" href="#" onclick="swich(6)">Jounal 6</a></li>
			<li><a id = "m7" href="#" onclick="swich(7)">Jounal 7</a></li>
			<div id="popup">Selected text is negative</div>
		</ul>
		<img id="weather" src="./src/1.png" onclick="enable_click()">
	</aside>

	<!--Pop up Question-->
	<div class="dislog" style="display: {{block}};">
		<div class="dis_cont">
			<!--Button-->
			<div class="close_window">
				<label class="close-bt" onclick="mood_hide()">x</label>
			</div>
			<!--Window-->
			<div class="cont_dis">
				How is your day?
			</div>
			<div class="dis_bott">
				<label class="left_name" onclick="left()">Bad Day</label>
				<label class="middle_name" onclick="middle()">Not Bad</label>
				<label class="right_name" onclick="right()">Wonderful</label>
			</div>
		</div>
	</div>

	<div class="container">
		<div class="backdrop">
			<div class="highlights"></div>
		</div>
		<div id="myModal" class="modal-content" style="border: 5px; opacity: 1; padding: 0 0 2rem 0;">
			<span class="close">&times;</span>
			<h3 style=" padding: 0 2rem;"><span id="cog_dist" style="background-color: #dcb1e5; border-radius: 5px;">Cognitive Distortion</span></h2>
			<h3 style="color:#BABABA; padding: 0 2rem;">Definition</h3>
				<p id="cd_def" style="padding: 0 3rem;">This cognitive distortion...</p>
			<h3 style="color:#BABABA; padding: 0 2rem;">Examples</h3>
				<ol id="cd_ex" style="padding: 0 7rem;">
					<li id="ex1">Coffee</li>
					<!--<li id="ex2">Tea</li>
					<li id="ex3">Milk</li>-->
				</ol> 
		</div>
		<textarea id="write" autofocus spellcheck="false"></textarea>
		<!-- init client -->
		<script>
			var socket = io();
			var cm;
			socket.on('doc', function(data) {
			  cm = CodeMirror.fromTextArea(document.getElementById('write'), {lineNumbers: true, styleSelectedText: true});
			  cm.setValue(data.str);
			  var serverAdapter = new ot.SocketIOAdapter(socket);
			  var editorAdapter = new ot.CodeMirrorAdapter(cm);
			  var client = new ot.EditorClient(data.revision, data.clients, serverAdapter, editorAdapter);
			})

			$(function() {
				$.contextMenu({
					selector: '.CodeMirror',
					callback: function(key, options) {
						console.log("Click atï¼š" + key);
					},
					items: {
						"fetch": {
							name: "Fetch", 
							icon: "edit",
							callback: function(itemKey, opt, rootMenu, originalEvent) {
								console.log("fetch:")
								console.log("loc:", cm.getCursor("from"), cm.getCursor("to"));
								console.log("content:", cm.getSelection())
							}
						},
						"highlight": {
							name: "Highlight", 
							icon: "fa-flag",
							callback: function(itemKey, opt, rootMenu, originalEvent) {
								if (cm.somethingSelected()) {
									let from_line = parseInt(cm.getCursor("from")["line"])
									let from_ch = parseInt(cm.getCursor("from")["ch"])
									let to_line = parseInt(cm.getCursor("to")["line"])
									let to_ch = parseInt(cm.getCursor("to")["ch"])
									console.log({line: from_line, ch: from_ch}, {line: to_line, ch: to_ch})
									cm.markText({line: from_line, ch: from_ch}, {line: to_line, ch: to_ch}, {className: "styled-background"})
								}
								
							}
						},
						"command": {
							name: "Command Demo", 
							icon: "fa-beer",
							callback: function(itemKey, opt, rootMenu, originalEvent) {
								if (cm.somethingSelected()) {
									let string = cm.getSelection();
									let start =  '('+ cm.getCursor("from")["line"] + ',' +  cm.getCursor("from")["ch"] + ')';
									let end = '('+ cm.getCursor("to")["line"] + ',' +  cm.getCursor("to")["ch"] + ')';
									let command = "Demo_Command," + start + "," + end + ','+ string;
									socket.emit("sentToServer", command);
								}
								
							}
						},
						"undo": {
							name: "Undo", 
							icon: "fa-undo",
							callback: function(itemKey, opt, rootMenu, originalEvent) {
								cm.undo()
							}
						},
						"redo": {
							name: "Redo", 
							icon: "fa-repeat",
							callback: function(itemKey, opt, rootMenu, originalEvent) {
								cm.redo()
							}
						},
						"clear": {
							name: "Clear All", 
							icon: "delete",
							callback: function(itemKey, opt, rootMenu, originalEvent) {
								console.log("clear all")
								console.log(cm.setValue(""));
							}
						}
					}
				});
			});
			// Demo: Control Clients(index.html) thru socket
			function Test(){
				//let message = $("#message").val().trim();
				let command = "Test command!";
				socket.emit("sentToServer", command);
			}
			function control(i){
				//let message = $("#message").val().trim();
				let command = "Expert: Command" + i;
				socket.emit("sentToServer", command);
			}
		</script>
	</div>
</body>

</html>